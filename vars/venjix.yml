---
flask_app_name: "venjix"

flask_paths:
  base: "/var/www/venjix"
  log: "/var/log/venjix"

flask_python_version: "3.8"

flask_git:
  user: "ait-cs-IaaS"
  repo: "venjix"

# -------------------------------------------
# *** Venjix ENV variables ***
# -------------------------------------------

flask_ENV_variables:
  VENJIX_AUTH_SECRET: "{{ VENJIX_AUTH_SECRET }}"
  SCRIPT_DIR: "{{ SCRIPT_DIR | default('scripts') }}"
  
# -------------------------------------------
# *** Venjix Service ***
# -------------------------------------------

flask_service_files:
  service:
    template: "flask.service.j2"
    destination: "/etc/systemd/system/venjix.service"

flask_service:
  name: "{{ (flask_service_files.service['destination'] | basename | split('.service'))[0] }}"
  description: "venjix daemon"
  user: "{{ flask_user }}"
  group: "{{ flask_usergroup }}"
  WorkingDirectory: "{{ flask_paths.base }}"
  EnvironmentFile: "/etc/environment"
  ExecStart: >
    {{ flask_paths.base }}/venv/bin/gunicorn 
    --workers 5
    wsgi:app
    --bind 127.0.0.1:{{ learners_ports.venjix }}
    --pythonpath={{ flask_paths.base }}/venv/lib/python{{ flask_python_version }}
  state: restarted
  autostart: yes
  reload: yes