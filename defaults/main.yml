---
learners_vhost: "localhost"

learners_user: "www-data"
learners_usergroup: "{{ learners_user }}"

learners_paths:
  base: "/var/www/learners"
  log: "/var/log/learners"

learners_python_version: "3.8"

learners_git:
  user: "ait-cs-IaaS"
  repo: "learners"
  token: "{{ lookup('env', 'LEARNERS_ACCESS_TOKEN') }}"
  branch: "master"
  force: yes
  always_reinstall: yes

learners_base_packages: 
  # base
  - "python{{ learners_python_version }}"
  - "python3-venv"
  - "python3-pip"
  - "git"
  # webserver
  - "nginx"
  # htpasswd
  - "python3-passlib"
  - "apache2-utils"

learners_config:
  LEARNERS_HTPASSWD: "temp_htpasswd" # location of passwd file: e.g. "/etc/nginx/htpasswd"
  JWT_SECRET_KEY: "53CR3T"

learners_components:
  VENJIX_URL:     "http://127.0.0.1:5001"
  VNC_URL:        "https://placeholder_2@10.17.4.219/"
  DOCS_URL:       "http://localhost:8080/en"
  EXERCISES_URL:  "http://localhost:8888/en"
  CALLBACK_URL:   "http://127.0.0.1:5000/callback"

learners_service_files:
  service:
    template: "learners.service.j2"
    destination: "/etc/systemd/system/learners.service"
  socket:
    template: "learners.socket.j2"
    destination: "/etc/systemd/system/learners.socket"

learners_service:
  name: "{{ (learners_service_files.service['destination'] | basename | split('.service'))[0] }}"
  user: "{{ learners_user }}"
  group: "{{ learners_usergroup }}"
  RuntimeDirectory: "learners_runtime"
  WorkingDirectory: "{{ learners_paths.base }}"
  ExecStart: >
    {{ learners_paths.base }}/venv/bin/gunicorn --workers 5 wsgi:app
    --pythonpath={{ learners_paths.base }}/venv/lib/python{{ learners_python_version }}
  state: restarted
  autostart: yes
  reload: yes

  